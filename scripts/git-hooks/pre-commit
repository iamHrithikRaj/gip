#!/bin/bash
#
# Gip Pre-commit Hook
# Checks for formatting and linting compliance on staged files.
#

# ANSI color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}[Pre-commit]${NC} Starting checks..."

# Get staged source files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.rs$")

if [ -z "$STAGED_FILES" ]; then
    echo -e "${GREEN}[Pre-commit]${NC} No source files staged. Skipping."
    exit 0
fi

# Check for tools
if ! command -v cargo &> /dev/null; then
    echo -e "${RED}[Pre-commit]${NC} cargo not found. Cannot run checks."
    exit 1
fi

echo -e "${YELLOW}[Pre-commit]${NC} Checking formatting..."
if ! cargo fmt -- --check; then
    echo -e "${RED}[Pre-commit]${NC} Formatting check failed."
    echo "Please run: cargo fmt"
    exit 1
fi

echo -e "${YELLOW}[Pre-commit]${NC} Running clippy..."
if ! cargo clippy -- -D warnings; then
    echo -e "${RED}[Pre-commit]${NC} Clippy check failed."
    echo "Please fix the issues above."
    exit 1
fi

echo -e "${GREEN}[Pre-commit]${NC} All checks passed!"
exit 0
